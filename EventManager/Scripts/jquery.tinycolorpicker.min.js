(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):typeof exports=="object"?module.exports=n(require("jquery")):n(jQuery)})(function(n){function r(r,u){function b(){return v?(e=n("<canvas><\/canvas>"),o.append(e),a=e[0].getContext("2d"),k()):n.each(f.options.colors,function(n,t){var i=w.clone();i.css("backgroundColor",t);i.attr("data-color",t);s.append(i)}),d(),f}function k(){var t=new Image,i=o.css("background-image").replace(/"/g,"").replace(/url\(|\)$/ig,"");t.crossOrigin="Anonymous";o.css("background-image","none");n(t).load(function(){e.attr("width",this.width);e.attr("height",this.height);a.drawImage(t,0,0,this.width,this.height)});t.src=f.options.backgroundUrl||i}function d(){var t=y?"touchstart":"mousedown";v?(l.bind(t,function(t){t.preventDefault();t.stopPropagation();o.toggle();n(document).bind("mousedown.colorpicker",function(){n(document).unbind(".colorpicker");f.close()})}),y?(e.bind("touchstart",function(n){return h=!0,c(n.originalEvent.touches[0]),!1}),e.bind("touchmove",function(n){return c(n.originalEvent.touches[0]),!1}),e.bind("touchend",function(){return f.close(),!1})):(e.mousedown(function(t){return h=!0,c(t),n(document).bind("mouseup.colorpicker",function(){return n(document).unbind(".colorpicker"),f.close(),!1}),!1}),e.mousemove(c))):(l.bind("mousedown",function(n){n.preventDefault();n.stopPropagation();s.toggle()}),s.delegate("li","mousedown",function(t){t.preventDefault();t.stopImmediatePropagation();var i=n(this).attr("data-color");f.setColor(i);s.hide()}))}function c(t){if(h){var e=n(t.target),u=e.offset(),i=a.getImageData(t.pageX-u.left,t.pageY-u.top,1,1).data;f.setColor("rgb("+i[0]+","+i[1]+","+i[2]+")");r.trigger("change",[f.colorHex,f.colorRGB])}}this.options=n.extend({},i,u);this._defaults=i;this._name=t;var f=this,o=r.find(".track"),l=r.find(".color"),e=null,p=r.find(".colorInput"),s=r.find(".dropdown"),w=s.find("li").remove(),a=null,h=!1,v=!!document.createElement("canvas").getContext,y="ontouchstart"in document.documentElement;return this.colorHex="",this.colorRGB="",this.setColor=function(n){n.indexOf("#")>=0?(f.colorHex=n,f.colorRGB=f.hexToRgb(f.colorHex)):(f.colorRGB=n,f.colorHex=f.rgbToHex(f.colorRGB));l.find(".colorInner").css("backgroundColor",f.colorHex);p.val(f.colorHex)},this.close=function(){h=!1;o.hide()},this.hexToRgb=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return"rgb("+parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)+")"},this.rgbToHex=function(n){function i(n){var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return isNaN(n)?"00":t[(n-n%16)/16]+t[n%16]}var t=n.match(/\d+/g);return"#"+i(t[0])+i(t[1])+i(t[2])},b()}var t="tinycolorpicker",i={colors:["#ffffff","#A7194B","#FE2712","#FB9902","#FABC02","#FEFE33","#D0EA2B","#66B032","#0391CE","#0247FE","#3D01A5","#8601AF"],backgroundUrl:null};n.fn[t]=function(i){return this.each(function(){n.data(this,"plugin_"+t)||n.data(this,"plugin_"+t,new r(n(this),i))})}});